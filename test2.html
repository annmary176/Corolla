<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Simple Math Test â€” Corolla</title>

<style>
  /* Modern Gradient Background */
  body {
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #e8e0ff 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    color: #4A4A68;
  }

  /* Shiny Glassmorphism Box */
  .box {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(12px);
    width: 360px;
    padding: 40px;
    border-radius: 24px;
    box-shadow: 0 20px 40px rgba(126, 87, 255, 0.1), 
                0 1px 3px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.7);
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  /* Shiny subtle overlay */
  .box::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, transparent 70%);
    pointer-events: none;
  }

  .question {
    font-size: 2.2rem;
    font-weight: 700;
    color: #2D2D44;
    margin-bottom: 25px;
    letter-spacing: -1px;
  }

  /* Clean Input Styling */
  input {
    padding: 12px;
    width: 140px;
    text-align: center;
    font-size: 1.2rem;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
    background: white;
    transition: all 0.3s ease;
    outline: none;
    color: #4f46e5;
    font-weight: 600;
    margin-bottom: 10px;
  }

  input:focus {
    border-color: #818cf8;
    box-shadow: 0 0 0 4px rgba(129, 140, 248, 0.1);
  }

  /* Shiny Purple Button */
  button {
    margin-top: 15px;
    padding: 14px 30px;
    background: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);
    border: none;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    width: 100%;
  }

  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    filter: brightness(1.1);
  }

  button:active {
    transform: translateY(0);
  }

  .status {
    margin-top: 20px;
    font-weight: 600;
    color: #8E8EAC;
    font-size: 0.9rem;
    height: 20px;
  }

  /* Removes arrows from number input */
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
</style>
</head>

<body>

<div class="box">
  <div class="question" id="question">Loading...</div>
  <input type="number" id="answer" placeholder="?">
  <br>
  <button onclick="submitAnswer()">Submit Answer</button>
  <div class="status" id="status"></div>
</div>

<script>
/* API endpoint (KEPT EXACTLY THE SAME) */
let firstKeyTime = null;
const API_URL = "http://localhost:8001/analyze-test2";
const NEXT_TEST_URL = "test3.html";
const RESULTS_URL = "results.html";

document.getElementById("answer").addEventListener("input", () => {
  if (firstKeyTime === null) {
    firstKeyTime = Math.round(performance.now() - startTime);
  }
});

/* 10 fixed questions with expected (normal) time */
const questions = [
  { q: "2 + 3", ans: 5, normalTime: 4000 },
  { q: "7 - 4", ans: 3, normalTime: 5000 },
  { q: "5 + 6", ans: 11, normalTime: 5000 },
  { q: "9 - 2", ans: 7, normalTime: 6000 },
  { q: "3 + 8", ans: 11, normalTime: 5000 },
  { q: "6 + 4", ans: 10, normalTime: 5000 },
  { q: "10 - 3", ans: 7, normalTime: 6000 },
  { q: "4 + 9", ans: 13, normalTime: 6000 },
  { q: "8 - 5", ans: 3, normalTime: 5000 },
  { q: "7 + 2", ans: 9, normalTime: 4000 }
];

let index = 0;
let startTime = 0;
let results = [];

/* Show question */
function showQuestion() {
  if (index >= questions.length) {
    sendToAPI();
    document.getElementById("question").innerText = "Test Completed ðŸŽ‰";
    document.getElementById("answer").style.display = "none";
    document.querySelector("button").style.display = "none";
    return;
  }

  document.getElementById("question").innerText =
    questions[index].q + " = ?";

  document.getElementById("answer").value = "";
  document.getElementById("status").innerText = "";
  document.getElementById("answer").focus();

  startTime = performance.now();
  firstKeyTime = null; // reset for new question
}

function submitAnswer() {
  const userInput = document.getElementById("answer").value;
  const timeTaken = Math.round(performance.now() - startTime);

  results.push({
    question: questions[index].q,
    user_input: userInput === "" ? null : Number(userInput),
    correct_answer: questions[index].ans,
    normal_time_ms: questions[index].normalTime,
    first_keystroke_time_ms: firstKeyTime,
    user_time_ms: timeTaken
  });

  index++;
  showQuestion();
}

/* Allow Enter key to submit */
document.getElementById("answer").addEventListener("keypress", (e) => {
  if (e.key === "Enter") submitAnswer();
});

/* Send collected data to API (KEPT EXACTLY THE SAME) */
function sendToAPI() {
  let correctCount = 0;
  let totalTime = 0;
  
  results.forEach(result => {
    if (result.user_input === result.correct_answer) {
      correctCount++;
    }
    totalTime += result.user_time_ms;
  });

  const payload = {
    user_id: "user_" + Date.now(),
    test_id: "logic_test_1",
    questions_attempted: results.length,
    correct_answers: correctCount,
    total_questions: questions.length,
    logic_time_ms: totalTime,
    max_logic_time_ms: totalTime + 5000,
    logical_errors: questions.length - correctCount
  };

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(response => response.json())
  .then(data => {
    console.log("API Response:", data);
    let allResults = JSON.parse(localStorage.getItem('testResults') || '{}');
    allResults.test2 = {
      type: "Logic",
      array: data.array,
      timestamp: new Date().toISOString()
    };
    localStorage.setItem('testResults', JSON.stringify(allResults));
    
    // Always go to next test
    window.location.href = NEXT_TEST_URL;
  })
  .catch(error => {
    console.error("Error:", error);
    window.location.href = NEXT_TEST_URL;
  });
}

/* Start test */
showQuestion();
</script>

</body>
</html>